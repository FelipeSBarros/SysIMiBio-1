{% extends "base.html" %}

{% load leaflet_tags %}

{% load static %}

{% block js %}
{% leaflet_js %}
{% endblock %}

{% block css %}
{% leaflet_css %}
{% endblock %}

{% block content %}
<style>
    #map-detail {
        width: 100%;
        height: 100%;
    }


</style>

{% if messages %}
{% for message in messages %}
<div class="alert alert-success" role="alert">
    <p>{{ message }}</p>
</div>
{% endfor %}
{% endif %}


<br>
<div class="row">
    <!--    <a role="button" class="btn btn-success btn-lg" href="{% url 'bioblitz:list_bioblitz_projects' %}">-->
    <!--        <span class="align-middle">Volver</span>-->
    <!--    </a>-->
    &nbsp; <h2>Detalles de la parcela: {{ object.name }}</h2>
</div>
<div class="row">
    <div class="col-sm-4">
        <table class="table table-user-information">
            <tbody>
            <tr>
                <th class="text-right">Nombre de la parcela permanente</th>
                <td>{{ object.name }}</td>
            </tr>
            <tr>

                <th class="text-right">Coordinador(a)</th>
                <td>{{ object.coordinator }}</td>
            </tr>

            <th class="text-right">Provincia</th>
            <td>{{ object.province }}</td>
            </tr>

            <th class="text-right">Municipio</th>
            <td>{{ object.municipality }}</td>
            </tr>

            <th class="text-right">Localidad</th>
            <td>{{ object.locality }}</td>
            </tr>

            <th class="text-right">Observaciones</th>
            <td>{{ object.obs|linebreaks }}</td>
            </tr>

            </tbody>
        </table>

        <a role="button" class="btn navbar-btn btn-warning"
           href="{% url 'imibio_tree_ecological_data:plot_list' %}">Volver</a>

    </div>

    <div class="col-sm-8">
        <div id="map-detail">
            {% leaflet_map "map-detail" %}
        </div>
    </div>
    <!-- todo crear serializador geojson para plot mapa-->
    <script>
      var dataurl = '{% url "imibio_tree_ecological_data:plot_detail_geojson" pk=object.pk %}';

      window.addEventListener("map:init", function (event) {
        var map = event.detail.map;
        // Download GeoJSON data with Ajax
        fetch(dataurl)
          .then(function(resp) {
            return resp.json();
          })
          .then(function(data) {
            L.geoJson(data, {
              onEachFeature: function onEachFeature(feature, layer) {
                var props = feature.properties.popup_content;
                layer.bindPopup(props);
                 map.fitBounds(layer.getBounds());
            }}).addTo(map);
          });
      });

    </script>


    {% endblock content %}